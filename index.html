<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- CSP and meta tags unchanged -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' 'unsafe-eval' blob:
      https://cdn.tailwindcss.com
      https://cdn.jsdelivr.net
      https://www.paypal.com
      https://www.paypalobjects.com
      https://apis.google.com
      https://widget.cloudinary.com
      https://upload-widget.cloudinary.com
      https://cdn.jsdelivr.net/npm/@emailjs/browser@4
      https://www.gstatic.com
      https://933-ship-it.github.io
      https://infird.com
      https://*.paypal.com
      https://*.paypalobjects.com
      https://*.braintreegateway.com
      https://www.googletagmanager.com
      https://www.google-analytics.com;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    img-src 'self' data: blob:
      https://933-ship-it.github.io
      https://res.cloudinary.com
      https://lh3.googleusercontent.com
      https://www.google.com
      https://www.paypalobjects.com
      https://www.google-analytics.com;
    font-src 'self' https://fonts.gstatic.com;
    connect-src 'self'
      https://*.paypal.com
      https://*.paypalobjects.com
      https://*.braintree-api.com
      https://*.braintreegateway.com
      https://api.emailjs.com
      https://933-ship-it.github.io
      https://www.googleapis.com
      https://identitytoolkit.googleapis.com
      https://firestore.googleapis.com
      https://securetoken.googleapis.com
      https://www.googletagmanager.com
      https://www.google-analytics.com
      https://overbridgenet.com;
    frame-src 'self'
      https://www.paypal.com
      https://*.paypal.com
      https://widget.cloudinary.com
      https://upload-widget.cloudinary.com
      https://*.paypalobjects.com
      https://*.braintreegateway.com;
    object-src 'none';
    base-uri 'self';
    form-action 'self';
  "/>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TradeDeck</title>
  <link rel="icon" type="image/png" href="assets/logo.png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>
  <!-- PATCH: Add PayPal SDK (with "components=buttons,marks,hosted-fields,funding-eligibility" to ensure full funding options) -->
  <script src="https://www.paypal.com/sdk/js?client-id=AbAmxidRUaYCqMND4GbNaw_9KBb6xEFlH1cLXoIwObQNjJtlgvJ0lSg7rvgVKGrwIQAWgmne6oAy0wFl&currency=USD&components=buttons,marks,funding-eligibility"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-XXXXXXXXXX');
  </script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    main section { transition: opacity 0.3s; }
    main section.hidden { opacity: 0; height: 0; overflow: hidden; position: absolute; pointer-events: none; visibility: hidden; }
    .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px rgba(0,0,0,0.1); }
    .product-card { transition: all 0.2s; }
    .input-invalid { border-color: #ef4444 !important; box-shadow: 0 0 0 1px #ef4444 !important; }
    .error-summary { background: #fee2e2; color: #b91c1c; padding: 0.75rem 1rem; border-radius: 0.5rem; margin-bottom: 1rem; }
    .interactive-card { cursor: pointer; }
    .interactive-card:hover { border-color: #60a5fa; }
    .success { color: #16a34a; }
    .error { color: #dc2626; }
    .loading { color: #fbbf24; }
    #editProductModal { z-index: 1000; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0;}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    (function(){
      emailjs.init({ publicKey: 'fmwYD8DAojsvufds2' });
    })();
  </script>
</head>
<body class="bg-gray-100">
  <!-- ... rest of body unchanged ... -->
  <!-- PATCH: Add PayPal Smart Payment Buttons with Debit Card support -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Wait for the PayPal SDK to be loaded
      function renderPayPalButtons() {
        const paypalContainer = document.getElementById('paypal-button-container');
        if (paypalContainer && window.paypal && typeof window.paypal.Buttons === 'function') {
          // Clear previous buttons (if any)
          paypalContainer.innerHTML = '';
          // PATCH: Render PayPal buttons with Card funding source enabled
          window.paypal.Buttons({
            style: {
              layout: 'vertical',
              color: 'blue',
              shape: 'rect',
              label: 'paypal'
            },
            // Enable both PayPal and Card funding sources
            fundingSource: undefined, // allows all eligible
            createOrder: function(data, actions) {
              // PATCH: Provide a dummy order for demonstration; replace amount as needed
              return actions.order.create({
                purchase_units: [{
                  amount: {
                    value: '10.00' // PATCH: Replace with dynamic product price
                  }
                }]
              });
            },
            onApprove: function(data, actions) {
              return actions.order.capture().then(function(details) {
                alert('Transaction completed by ' + details.payer.name.given_name + '!');
                // PATCH: Handle post-purchase logic here
              });
            },
            onError: function(err) {
              alert('PayPal error: ' + err.toString());
            }
          }).render('#paypal-button-container');
        }
      }
      // PATCH: Always render PayPal buttons on product details section show
      const showProductDetails = function() {
        renderPayPalButtons();
      };
      // PATCH: If your app uses JS to show the product details section, call showProductDetails() accordingly
      // For demo: render on page load if the container exists
      renderPayPalButtons();
      // If you want to re-render on tab switch or product selection, call renderPayPalButtons() after showing #productDetails
      // Optionally observe DOM changes to re-render as needed
    });
  </script>
  <!-- Firebase v9+ Modular SDK, Autosave, Validation, All Flows, Modern JS -->
  <script type="module" src="https://933-ship-it.github.io/TradeDeck.com/production-app.js"></script>
</body>
</html>
